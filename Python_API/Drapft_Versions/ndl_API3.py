import prestodb
from getpass import getpass
import pandas as pd
from sqlalchemy import create_engine
import time


def c_NDL_Query (v_sql_commands):
    username=''
    password=''
    host = 'ndl-presto.nss.vzwnet.com'
    port = 8385
    catalog = 'hive'
    http_scheme = 'https'

    if not username:
        username = 'canobhu'
        #input("Username: ")
    if not password:
        password = 'Tpztlan02VH#'
        #getpass("Password: ")

    con = prestodb.dbapi.connect(
                            host=host,
                            port=port,
                            user=username,
                            catalog=catalog,
                            http_scheme=http_scheme,
                            auth=prestodb.auth.BasicAuthentication(username, password)
                        )


    cur = con.cursor()

    cur.execute(v_sql_commands)
    rows = cur.fetchall()
    columns = cur.description
    headers = []
    for columns in columns:
        headers.append(columns[0])

    df = pd.DataFrame (rows, columns=headers)
    print (df)


    time.sleep (20)
    '''
    rows.columns = [
                    'xlpt_site_name',                       
                    'xlpt_site_number',
                    'xlpt_market',
                    'xlpt_market_desc',
                    'atoll_site_latitude_degrees_nad83',
                    'atoll_site_longitude_degrees_nad83',
                    'atoll_county',
                    'atoll_msa_rsa'
    ]    
    '''
    return (df)

def c_KPI_table_format(rows):

    #v_query = pd.DataFrame(rows)

    rows.columns = [
    'mmepool','market','site','enodeb', 

    'Month',
    'Year',
    'peakactive_ues_AVG',
    'ue_dl_volume_mb_qci_8_AVG',
    'volte_attempts_AVG',
    'ue_downlink_throughput_AVG',

    'bearer_drop%_voice_num_SUM',
    'bearer_drop%_voice_den_SUM',   

    'sip_call_attempts_SUM',
    'sip_call_completions_SUM',
    'sip_call_failures_SUM',
    'sip_call_answers_SUM',
    'sip_call_drops_SUM',
    'rrc_establishmentatt_SUM',
    'rrc_setup_failures_SUM',
    'initial_erab_establishmentatt_SUM',
    'initial_erab_establishmentsucc_SUM',
    'peoplesoft_location_code',
    'environment_morphology'
    ]

    #print (v_query)

    #print (v_query.columns)

    return(rows)

def c_to_sql(v_data,v_table):
    v_databasae = 'vzw_RootMetrics'


    engine = create_engine("mysql+pymysql://{user}:{pw}@localhost/{db}"
                        .format(user="root",
                                pw="Tpztlan02VH",
                                db=v_databasae))
    v_data.to_sql(v_table, con = engine, if_exists = 'append', index=False)

def c_NDL_KPI_commands():

    v_sql_commands = ("""

    SELECT
    mmepool, market, site, enodeb, 

    month(to_date(trans_dt,'yyyymmdd')),
    year(to_date(trans_dt,'yyyymmdd')),

    AVG(peakactive_ues),
    AVG(ue_dl_volume_mb_qci_8),
    AVG(volte_attempts),
    AVG(ue_downlink_throughput),

    SUM("bearer_drop%_voice_num") as BD_num, 
    SUM("bearer_drop%_voice_den") as BD_den,     

    SUM(sip_call_attempts),
    SUM(sip_call_completions),
    SUM(sip_call_failures),
    AVG(sip_call_answers),
    SUM(sip_call_drops),
    SUM(rrc_establishmentatt),
    SUM(rrc_setup_failures),
    SUM(initial_erab_establishmentatt),
    SUM(initial_erab_establishmentsucc),

    atoll.peoplesoft_location_code,
    atoll.environment_morphology

    FROM elpt_presto_views.daily_ericssonenodebkpisall_enb xLPT
    LEFT JOIN vzatoll.f_vzatoll_lte_v4 atoll on xLPT.enodeb = atoll.gnb_enb_id

    WHERE 
        to_date(trans_dt,'yyyymmdd') between 
                
                DATE_ADD('month', -1 , current_date)
                AND
                DATE_ADD('day', -1 , current_date)
                
        AND
        mmepool = 'Mountain'
        AND
        market in ('010','011','012','013')

    GROUP BY 
        mmepool, market, site, enodeb, 
        month(to_date(trans_dt,'yyyymmdd')),
        year(to_date(trans_dt,'yyyymmdd')),
        atoll.peoplesoft_location_code,
        atoll.environment_morphology

    ORDER BY
    market, enodeb, month(to_date(trans_dt,'yyyymmdd')) ASC

                """)
    return (v_sql_commands)

def c_NDL_xLPT_GEO():
    v_sql_commands = ("""
                select 
                xlpt_site_name,
                xlpt_site_number,
                xlpt_market,
                xlpt_market_desc,
                atoll_site_latitude_degrees_nad83,
                atoll_site_longitude_degrees_nad83,
                atoll_county,
                atoll_msa_rsa
    
                from fuze_presto_views.dmp_xlpt_atoll_geo_view
                where xLPT_Site_Number in ('010460',
                '311150',
                '010131',
                '010349',
                '010312',
                '013352',
                '011122',
                '010384',
                '313272',
                '011041',
                '010316',
                '010208',
                '013306',
                '011386',
                '010251',
                '013387',
                '313321',
                '010129',
                '011250',
                '011311',
                '010600',
                '010381',
                '013149',
                '011542',
                '010263',
                '011261',
                '011334',
                '013349',
                '011136',
                '313242',
                '313307',
                '313323',
                '011055',
                '011141',
                '010361',
                '010033',
                '311210',
                '313314',
                '311145',
                '010326',
                '010223',
                '010388',
                '011171',
                '311325',
                '010345',
                '010324',
                '011305',
                '010235',
                '011030',
                '311297',
                '010340',
                '010292',
                '010373',
                '011156',
                '013208',
                '010389',
                '313312',
                '011163',
                '010230',
                '013203',
                '013017',
                '313068',
                '311348',
                '011602',
                '013336',
                '010400',
                '010190',
                '010212',
                '313316',
                '311332',
                '010308',
                '010046',
                '310611',
                '011083',
                '313302',
                '313060',
                '010261',
                '010283',
                '011071',
                '313158',
                '011500',
                '313075',
                '013011',
                '013226',
                '013222',
                '011180',
                '013294',
                '013325',
                '313292',
                '013369',
                '010049',
                '011147',
                '013067',
                '010239',
                '010003',
                '013204',
                '013088',
                '013263',
                '011135',
                '010279',
                '313329',
                '010420',
                '013109',
                '011157',
                '011268',
                '010410',
                '010564',
                '010228',
                '010209',
                '011251',
                '011050',
                '013217',
                '311359',
                '313470',
                '013445',
                '010440',
                '010029',
                '313130',
                '010141',
                '010330',
                '013367',
                '011269',
                '011299',
                '011164',
                '011197',
                '011314',
                '013052',
                '010452',
                '313043',
                '010948',
                '011344',
                '010211',
                '011263',
                '010576',
                '011168',
                '013297',
                '011363',
                '011257',
                '013083',
                '011320',
                '010225',
                '310360',
                '011267',
                '312217',
                '011153',
                '013266',
                '013384',
                '013466',
                '011510',
                '010161',
                '011165',
                '011600',
                '010401',
                '010603',
                '011315',
                '010023',
                '013005',
                '013317',
                '010056',
                '013210',
                '011302',
                '013207',
                '013230',
                '010494',
                '010255',
                '011195',
                '010311',
                '013378',
                '010393',
                '311162',
                '010179',
                '013051',
                '011234',
                '010555',
                '010091',
                '010271',
                '010007',
                '011264',
                '311274',
                '011155',
                '313453',
                '013372',
                '011179',
                '010012',
                '013318',
                '011373',
                '011101',
                '010417',
                '011166',
                '011294',
                '013201',
                '010423',
                '010303',
                '010014',
                '010200',
                '013097',
                '011106',
                '013328',
                '010491',
                '010203',
                '010277',
                '313338',
                '011277',
                '010309',
                '010503',
                '013018',
                '010319',
                '011304',
                '010269',
                '010415',
                '013365',
                '011139',
                '011235',
                '013251',
                '011146',
                '013212',
                '013354',
                '011275',
                '011310',
                '011278',
                '011628',
                '010444',
                '010288',
                '011505',
                '313345',
                '011394',
                '010044',
                '010310',
                '013360',
                '010065',
                '010221',
                '013308',
                '010240',
                '013059',
                '010227',
                '010380',
                '011129',
                '313333',
                '011169',
                '013029',
                '013228',
                '013220',
                '011333',
                '013374',
                '010237',
                '010475',
                '010526',
                '013368',
                '013049',
                '010516',
                '010246',
                '010244',
                '011380',
                '010573',
                '310602',
                '011295',
                '011262',
                '311160',
                '013357',
                '010016',
                '011047',
                '010258',
                '013038',
                '011327',
                '011048',
                '011184',
                '010215',
                '013056',
                '013434',
                '010248',
                '013021',
                '011178',
                '313003',
                '010097',
                '013065',
                '311375',
                '010008',
                '010497',
                '013206',
                '010132',
                '010557',
                '010601',
                '313311',
                '010492',
                '311154',
                '011052',
                '011324',
                '013315',
                '010335',
                '010333',
                '010382',
                '011407',
                '010560',
                '010226',
                '311609',
                '010453',
                '013286',
                '010051',
                '010377',
                '013386',
                '010178',
                '011391',
                '011053',
                '013281',
                '010125',
                '013035',
                '013430',
                '011236',
                '010605',
                '011328',
                '013026',
                '013366',
                '313225',
                '013213',
                '011308',
                '011508',
                '010152',
                '010587',
                '011126',
                '011170',
                '313198',
                '010433',
                '010061',
                '311212',
                '013094',
                '310189',
                '010031',
                '011123',
                '010421',
                '011102',
                '010162',
                '013039',
                '011196',
                '011523',
                '011270',
                '011231',
                '010366',
                '013031',
                '010449',
                '010464',
                '011326',
                '011194',
                '011329',
                '010404',
                '010034',
                '010216',
                '013309',
                '011503',
                '013332',
                '010430',
                '010247',
                '010059',
                '011134',
                '013087',
                '010238',
                '013396',
                '010362',
                '011059',
                '313194',
                '013139',
                '011115',
                '013041',
                '011159',
                '010428',
                '010026',
                '011279',
                '013076',
                '010018',
                '010204',
                '011119',
                '011316',
                '011161',
                '312060',
                '010116',
                '010480',
                '010506',
                '013300',
                '013200',
                '312088',
                '010210',
                '010301',
                '011060',
                '010448',
                '011112',
                '010167',
                '010250',
                '010523',
                '011232',
                '313448',
                '013326',
                '010350',
                '010013',
                '013019',
                '010006',
                '010367',
                '013380',
                '013425',
                '011611',
                '010011',
                '010484',
                '010458',
                '011501',
                '013145',
                '010370',
                '010584',
                '011532',
                '010371',
                '310424',
                '013275',
                '013351',
                '011172',
                '012086',
                '013304',
                '013205',
                '013224',
                '010245',
                '013301',
                '010406',
                '010217',
                '013223',
                '011260',
                '011185',
                '010083',
                '013347',
                '011335',
                '011403',
                '010512',
                '010500',
                '011325',
                '010457',
                '013069',
                '010017',
                '010443',
                '013034',
                '010151',
                '013468',
                '313446',
                '011409',
                '313273',
                '013045',
                '313373',
                '011064',
                '011601',
                '010148',
                '011175',
                '013022',
                '010518',
                '013522',
                '010562',
                '011173',
                '013329',
                '011110',
                '313074',
                '010094',
                '010300',
                '010450',
                '013229',
                '013420',
                '313451',
                '010368',
                '011337',
                '011253',
                '011506',
                '011189',
                '011266',
                '313428',
                '013066',
                '010510',
                '010495',
                '010306',
                '010069',
                '013303',
                '011271',
                '011318',
                '313064',
                '013385',
                '011233',
                '313435',
                '010264',
                '313062',
                '010159',
                '011298',
                '010001',
                '013232',
                '013003',
                '312226',
                '011317',
                '013058',
                '010328',
                '013016',
                '011343',
                '010385',
                '011066',
                '013397',
                '013335',
                '010268',
                '013163',
                '010463',
                '311534',
                '012347',
                '011118',
                '010302',
                '013227',
                '011131',
                '013437',
                '013443',
                '013292',
                '010275',
                '011307',
                '010461',
                '010397',
                '013221',
                '011396',
                '010522',
                '010320',
                '013010',
                '011524',
                '013307',
                '011401',
                '011062',
                '010496',
                '013314',
                '313061',
                '010498',
                '011056',
                '010253',
                '011309',
                '011044',
                '010505',
                '011150',
                '313381',
                '011273',
                '011342',
                '013272',
                '010977',
                '013009',
                '010181',
                '010454',
                '313245',
                '013015',
                '013302',
                '013216',
                '010441',
                '013150',
                '313401',
                '011289',
                '011176',
                '013323',
                '010489',
                '013002',
                '010920',
                '011408',
                '010220',
                '013358',
                '013273',
                '010353',
                '310599',
                '011162',
                '010502',
                '010149',
                '010242',
                '013312',
                '013078',
                '011174',
                '013423',
                '311283',
                '011137',
                '013042',
                '011211',
                '013070',
                '011183',
                '010299',
                '011095',
                '010259',
                '010407',
                '010455',
                '013371',
                '010207',
                '010163',
                '010282',
                '010355',
                '013068',
                '010205',
                '013305',
                '010232',
                '010213',
                '013202',
                '013341',
                '011402',
                '013355',
                '010424',
                '010214',
                '313073',
                '010378',
                '311108',
                '010160',
                '011121',
                '010241',
                '010471',
                '013075',
                '010394',
                '010281',
                '013391',
                '013310',
                '013001',
                '010272',
                '013055',
                '010252',
                '011068',
                '010624',
                '013043',
                '011531',
                '313148',
                '011210',
                '010901',
                '010469',
                '010360',
                '011117',
                '010249',
                '313270',
                '011265',
                '010939',
                '310272',
                '013353',
                '311536',
                '011530',
                '011054',
                '010127',
                '010093',
                '010438',
                '013020',
                '013036',
                '013268',
                '013422',
                '011113',
                '313390',
                '011303',
                '011143',
                '010068',
                '010133',
                '011345',
                '011138',
                '013345',
                '013370',
                '013311',
                '011521',
                '013060',
                '011186',
                '313343',
                '010921',
                '010256',
                '013383',
                '012380',
                '013321',
                '311015',
                '013053',
                '011192',
                '013359',
                '013181',
                '010224',
                '310577',
                '011330',
                '010479',
                '010057',
                '010002',
                '013327',
                '013270',
                '010392',
                '010416',
                '010408',
                '010286',
                '010456',
                '013225',
                '010372',
                '013234',
                '013395',
                '010171',
                '010257',
                '010442',
                '010625',
                '010915',
                '010234',
                '013400',
                '010101',
                '013072',
                '013393',
                '010260',
                '010289',
                '013429',
                '010490',
                '010439',
                '011617',
                '010296',
                '010499',
                '010411',
                '010070',
                '010284',
                '013424',
                '010334',
                '012299',
                '011145',
                '013048',
                '013381',
                '013316',
                '010266',
                '312256',
                '010177',
                '013282',
                '010595',
                '010473',
                '013333',
                '010305',
                '011520',
                '313469',
                '010487',
                '010189',
                '013242',
                '011177',
                '010918',
                '011031',
                '013467',
                '011100',
                '010435',
                '010914',
                '013032',
                '010913',
                '011128',
                '010981',
                '010476',
                '011199',
                '010395',
                '013350',
                '011130',
                '013158',
                '013382',
                '011321',
                '011065',
                '010105',
                '013274',
                '011067',
                '013024',
                '013006',
                '010315',
                '013363',
                '010926',
                '010218',
                '010578',
                '011312',
                '013007',
                '011404',
                '011151',
                '013403',
                '010276',
                '013448',
                '013389',
                '011154',
                '011198',
                '013276',
                '010575',
                '313267',
                '010027',
                '010483',
                '011332',
                '010911',
                '010459',
                '013313',
                '013373',
                '010376',
                '011347',
                '010135',
                '011301',
                '011319',
                '013090',
                '011109',
                '012202',
                '010468',
                '010945',
                '011108',
                '013421',
                '013233',
                '013231',
                '011274',
                '010346',
                '013364',
                '013390',
                '011297',
                '013194',
                '011405',
                '011212',
                '011375',
                '013322',
                '013458',
                '013239',
                '013023',
                '010243',
                '010150',
                '010409',
                '013362',
                '013469',
                '010265',
                '010062',
                '010611',
                '010115',
                '010910',
                '011359',
                '010270',
                '013453',
                '013356',
                '010916',
                '011142',
                '010201',
                '011313',
                '010482',
                '012229',
                '010222',
                '012060',
                '011187',
                '010465',
                '011526',
                '010905',
                '010231',
                '011509',
                '013284',
                '013331',
                '013338',
                '011348',
                '013073',
                '013470',
                '010931',
                '013074',
                '313344',
                '013130',
                '010599',
                '011058',
                '010156',
                '010077',
                '013064',
                '010472',
                '011124',
                '010267',
                '012384',
                '010134',
                '013178',
                '011193',
                '013451',
                '010028',
                '313440',
                '013388',
                '010493',
                '013444',
                '013211',
                '311007',
                '011072',
                '011534',
                '011188',
                '012226',
                '013050',
                '010504',
                '010412',
                '012049',
                '013132',
                '011252',
                '010470',
                '010357',
                '013057',
                '013215',
                '011239',
                '013063',
                '011627',
                '010039',
                '013428',
                '012309',
                '010155',
                '013446',
                '013093',
                '012565',
                '011007',
                '013412',
                '010928',
                '010336',
                '010391',
                '010414',
                '311149',
                '013092',
                '313412',
                '013198',
                '010332',
                '013343',
                '013436',
                '010304',
                '013245',
                '013047',
                '013427',
                '012073',
                '012217',
                '013269',
                '011322',
                '010577',
                '010912',
                '011015',
                '010907',
                '010902',
                '010337',
                '013033',
                '013376',
                '010917',
                '013209',
                '013288',
                '010908',
                '012011',
                '010940',
                '011160',
                '010909',
                '010540',
                '011283',
                '311203',
                '013180',
                '012088',
                '010922',
                '010535',
                '013487',
                '013431',
                '011099',
                '011149',
                '010602',
                '011609',
                '013435',
                '013062',
                '011536',
                '013141',
                '013214',
                '010405',
                '013440',
                '010154',
                '010486',
                '010390',
                '012136',
                '013280',
                '013061',
                '010175',
                '011069',
                '012256',
                '013025',
                '013344',
                '013267',
                '010949',
                '010903',
                '013401',
                '010092',
                '011203',
                '013095',
                '013096',
                '010933',
                '011032',
                '313193',
                '010924',
                '013240',
                '011074',
                '013012',
                '010108',
                '013299',
                '013402',
                '013409',
                '010534',
                '010941',
                '013287',
                '010932',
                '313299',
                '010236',
                '013415',
                '010418',
                '010532',
                '011140',
                '013413',
                '013407',
                '011655',
                '010930',
                '013193',
                '011651',
                '012121',
                '010431',
                '013285',
                '010202',
                '011125',
                '010923',
                '010929',
                '013432',
                '013108',
                '010432',
                '013465',
                '013014',
                '013433',
                '011653',
                '013199',
                '010927',
                '013449',
                '313240',
                '012123',
                '012124',
                '012012',
                '012013',
                '013148',
                '012122',
                '013013',
                '012125',
                '013411',
                '011051',
                '010925',
                '011652',
                '011654',
                '013071',
                '010539',
                '012010',
                '011423',
                '011426',
                '011422',
                '011424',
                '011421',
                '011425')


                    """)

    

    return (v_sql_commands)

def c_NDL_xLPT_Cell_Availability ():
    v_sql_commands = ("""
                        SELECT
                            enodeb,
                            "cell_availability%",
                            trans_dt

                        FROM elpt_presto_views.daily_ericssonenodebkpisall_enb

                        WHERE 
                            to_date(trans_dt,'yyyymmdd') between 
                                    
                                    DATE_ADD('DAY', -90, current_date)
                                    AND
                                    DATE_ADD('day', -1 , current_date)
                                    
                            AND
                            mmepool = 'Mountain'
                            AND
                            market in ('010')
                            AND
                            enodeb ='010322'
                            
                        ORDER BY trans_dt DESC
                    """)
    return (v_sql_commands)

def c_NDL_Fuze_Query_SPM_Project_ID ():
    v_sql_commands = ("""
                        select *
                        from  fuze_presto_views.dmp_rfds_sp_fuze_dash_view 
                        Where dashboar_fuze_project_id = '16270299'
                            
                    """)
    return (v_sql_commands)

v_table = 'Morphology'
v_sql_commands = c_NDL_Fuze_Query_SPM_Project_ID()
v_data = c_NDL_Query(v_sql_commands)



#v_data = c_KPI_table_format (v_data)
print (v_data)
#c_to_sql(v_data,v_table)
